<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Alle opskrifter i airfryer – Opskrift-Airfryer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Se alle vores airfryeropskrifter samlet ét sted. Søg, filtrér og find præcis den opskrift du leder efter.">

  <link rel="stylesheet" href="../assets/styles.css" />

  <!-- Ekstra styling til de moderne filterknapper -->
  <style>
    .filter-bar-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 0;
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .filter-btn {
      border: 1px solid #e0e0e0;
      background: #ffffff;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.9rem;
      line-height: 1.2;
      cursor: pointer;
      transition: background 0.15s ease, box-shadow 0.15s ease, transform 0.05s ease,
                  color 0.15s ease, border-color 0.15s ease;
    }

    .filter-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .filter-btn.is-active {
      background: #111111;
      color: #ffffff;
      border-color: #111111;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>

<body>

<div data-include="icons"></div>
<div data-include="header"></div>

<!-- HERO som forsiden -->
<section class="hero-large"
         style="background-image: url('../assets/images/hero/hero-julebord-airfryer-1920x1080.jpg');">
  <div class="hero-large-overlay"></div>

  <div class="hero-large-content">

    <h1 class="hero-large-title">Alle opskrifter i airfryer</h1>

    <p class="hero-large-subtitle">
      Scroll gennem alle opskrifter eller brug søgning og kategorier for at finde præcis det, du leder efter.
    </p>

    <form class="hero-large-search" id="recipe-search-form">
      <input type="search" id="recipe-search" placeholder="Søg efter opskrift, ingrediens eller kategori …" />
      <button type="submit">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="15" y1="15" x2="21" y2="21"></line>
        </svg>
      </button>
    </form>

  </div>
</section>


<main>

  <!-- KATEGORIER UNDER HERO -->
  <section class="section-category" id="recipe-categories">
    <div class="category-header">
      <div>
        <h2 class="section-title">Vælg kategori</h2>
        <p class="section-desc">
          Du kan kombinere søgning og kategori – eller vælge “Alle” for at se hele oversigten.
        </p>
      </div>
    </div>

    <div class="filter-bar-inner">
      <div class="filter-buttons">
        <button class="filter-btn is-active" data-filter="Alle">Alle</button>
        <button class="filter-btn" data-filter="sproede-kartofler">Sprøde kartofler</button>
        <button class="filter-btn" data-filter="kyllingefavoritter">Kyllingefavoritter</button>
        <button class="filter-btn" data-filter="nem-aftensmad">Nem aftensmad</button>
        <button class="filter-btn" data-filter="snacks-tilbehor">Snacks & tilbehør</button>
        <button class="filter-btn" data-filter="sund-airfryer">Sund airfryer</button>
        <button class="filter-btn" data-filter="morgenmad">Morgenmad</button>
        <button class="filter-btn" data-filter="bagvaerk">Bagværk & søde sager</button>
        <button class="filter-btn" data-filter="jul">Jul</button>
      </div>
    </div>
  </section>

  <!-- OPSKRIFTSGRID -->
  <section class="section-category" style="margin-top:2.5rem; margin-bottom:3rem;">
    <div class="category-header">
      <h2 class="section-title">Alle opskrifter</h2>
      <p class="section-desc" id="recipes-count">Indlæser opskrifter …</p>
    </div>

    <div class="category-grid" id="recipes-grid"></div>

    <div id="recipes-empty-state"
         style="display:none; text-align:center; margin-top:2rem; max-width:720px; margin-left:auto; margin-right:auto; color:#666;">
      <p style="margin-bottom:0.75rem;">Der er ingen opskrifter, der matcher din søgning eller de valgte kategorier.</p>
      <p style="font-size:0.95rem;">
        Prøv at rydde søgefeltet, skifte kategori til <strong>Alle</strong> eller søge bredere (fx “kylling”
        i stedet for en specifik ret).
      </p>
    </div>
  </section>

</main>

<div data-include="footer"></div>
<div data-include="analytics"></div>

<script src="../assets/include.js" defer></script>
<script src="../assets/header.js" defer></script>

<!-- Hent recipes.json -->
<script>
  let ALL_RECIPES = [];

  async function loadRecipes() {
    try {
      const res = await fetch("/assets/recipes.json"); // samme som på forsiden
      const data = await res.json();

      // Normaliser data + nyeste først
      const raw = Array.isArray(data.recipes) ? data.recipes : [];
      ALL_RECIPES = raw
        .map(r => ({
          slug: r.slug,
          title: r.title,
          categories: Array.isArray(r.categories) ? r.categories : []
        }))
        .reverse();
    } catch (err) {
      console.error("Fejl ved indlæsning af recipes.json:", err);
      ALL_RECIPES = [];
    }
  }
</script>

<!-- Søgning + filtrering + render -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
  await loadRecipes();

  const grid = document.getElementById("recipes-grid");
  const countEl = document.getElementById("recipes-count");
  const emptyState = document.getElementById("recipes-empty-state");
  const filterButtons = document.querySelectorAll(".filter-btn");
  const searchForm = document.getElementById("recipe-search-form");
  const searchInput = document.getElementById("recipe-search");

  let activeFilter = "Alle";
  let searchQuery = "";
  let currentIndex = 0;             // hvor langt vi er nået i listen
  const PAGE_SIZE = 12;             // 12 opskrifter per klik

  // Opret “Vis flere”-knappen
  const loadMoreBtn = document.createElement("button");
  loadMoreBtn.textContent = "Vis flere opskrifter";
  loadMoreBtn.className = "btn btn-primary";
  loadMoreBtn.style.display = "block";
  loadMoreBtn.style.margin = "2rem auto 0";
  loadMoreBtn.style.padding = "0.75rem 1.5rem";
  loadMoreBtn.style.borderRadius = "999px";
  loadMoreBtn.style.fontSize = "1rem";
  loadMoreBtn.style.cursor = "pointer";
  loadMoreBtn.style.background = "#fff";
  loadMoreBtn.style.border = "1px solid #ddd";
  loadMoreBtn.style.transition = "all .2s ease";
  loadMoreBtn.onmouseover = () => (loadMoreBtn.style.boxShadow = "0 2px 8px rgba(0,0,0,0.12)");
  loadMoreBtn.onmouseout = () => (loadMoreBtn.style.boxShadow = "none");

  grid.insertAdjacentElement("afterend", loadMoreBtn);

  function createCard(recipe) {
    const card = document.createElement("article");
    card.className = "category-card";
    card.innerHTML = `
      <a class="category-card-link" href="./${recipe.slug}.html">
        <div class="category-card-image">
<img src="../assets/images/recipes/${recipe.slug}.jpg" onerror="this.style.display='none'">
        </div>
        <div class="category-card-body">
          <h3 class="category-card-title">${recipe.title}</h3>
        </div>
      </a>
    `;
    return card;
  }

  let CURRENT_LIST = [];

  function renderChunk() {
    const slice = CURRENT_LIST.slice(currentIndex, currentIndex + PAGE_SIZE);

    slice.forEach(recipe => {
      grid.appendChild(createCard(recipe));
    });

    currentIndex += PAGE_SIZE;

    // Hvis vi har vist det hele: skjul knappen
    if (currentIndex >= CURRENT_LIST.length) {
      loadMoreBtn.style.display = "none";
    } else {
      loadMoreBtn.style.display = "block";
    }
  }

  function renderRecipes(list) {
    grid.innerHTML = "";
    currentIndex = 0;

    if (list.length === 0) {
      emptyState.style.display = "block";
      loadMoreBtn.style.display = "none";
      return;
    }

    emptyState.style.display = "none";

    CURRENT_LIST = list;

    // Første chunk (10 opskrifter)
    renderChunk();

    // Opdater tekst
    if (countEl) {
      countEl.textContent = `Viser ${list.length} opskrifter`;
    }
  }

  function applyFilters() {
    const q = searchQuery.toLowerCase();

    const filtered = ALL_RECIPES.filter(r => {
      const cats = (r.categories || []).join(" ").toLowerCase();
      const title = r.title.toLowerCase();

      const matchesFilter =
        activeFilter === "Alle" ||
        (Array.isArray(r.categories) && r.categories.includes(activeFilter));

      const matchesSearch = !q || title.includes(q) || cats.includes(q);

      return matchesFilter && matchesSearch;
    });

    renderRecipes(filtered);
  }

  // Filter knapper
  filterButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      filterButtons.forEach(b => b.classList.remove("is-active"));
      btn.classList.add("is-active");
      activeFilter = btn.dataset.filter;
      applyFilters();
    });
  });

  // Søgning i hero
  searchInput.addEventListener("input", () => {
    searchQuery = searchInput.value;
    applyFilters();
  });

  // “Vis flere”
  loadMoreBtn.addEventListener("click", renderChunk);

  // Første render
  applyFilters();
});
</script>

</body>
</html>
