<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Alle opskrifter i airfryer – Opskrift-Airfryer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Se alle vores airfryeropskrifter samlet ét sted. Søg, filtrér og find præcis den opskrift du leder efter.">

  <link rel="stylesheet" href="../assets/styles.css" />

  <!-- Ekstra styling til filterknapper + grid -->
  <style>

    /* FILTER KNAPPER */
    .filter-bar-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 0;
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .filter-btn {
      border: 1px solid #e0e0e0;
      background: #ffffff;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .filter-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    }

    .filter-btn.is-active {
      background: #111;
      color: #fff;
      border-color: #111;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    /* GRID */
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.75rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* KORT */
    .category-card {
      border: 1px solid #e5e5e5;
      border-radius: 14px;
      background: #fff;
      overflow: hidden;
      transition: transform .15s ease, box-shadow .15s ease;
    }

    .category-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.10);
    }

    .category-card-image img {
      display: block;
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      background: #fafafa;
    }

    .category-card-body {
      padding: 1rem;
    }

    .category-card-title {
      font-size: 1.05rem;
      margin: 0;
      font-weight: 600;
      color: #111;
    }

  </style>
</head>

<body>

<script src="../assets/include.js" defer></script>
<script src="../assets/header.js" defer></script>

<!-- BILLED-MATCHING LOGIK -->
<script>
// Hardcoded liste over dine billedfiler i /assets/images/recipes
const IMAGE_FILES = [
  "bacon-airfryer-768x768.jpg",
  "chicken-nuggets-airfryer-768x768.jpg",
  "fiskefilet-768x768.jpg",
  "flaeskesteg-i-airfryer-768x768.jpg",
  "flaeskestegssandwich-768x768.jpg",
  "frikadeller-768x768.jpg",
  "grillede-groentsager-airfryer-768x768.jpg",
  "hvidloegsbroed-airfryer-768x768.jpg",
  "kyllinge-laar-airfryer-768x768.jpg",
  "kyllingebryst-airfryer-768x768.jpg",
  "kyllingevinger-i-airfryer-768x768.jpg",
  "laks-i-airfryer-768x768.jpg",
  "pommes-frites-768x768.jpg",
  "vegetar-tarteletter-768x768.jpg"
];

// Hjælpefunktion – fjern specialtegn og bindestreger
function normalize(str) {
  return (str || "")
    .toLowerCase()
    .replace(/-/g, " ")
    .replace(/æ/g, "ae")
    .replace(/ø/g, "oe")
    .replace(/å/g, "aa")
    .replace(/[^\w\s]/g, "");
}

// Fuzzy-match: Find bedste billednavn til en given slug
function findBestImage(slug) {
  const normSlug = normalize(slug);
  const slugWords = normSlug.split(" ").filter(Boolean);

  let bestScore = -1;
  let bestMatch = null;

  IMAGE_FILES.forEach(file => {
    const normFile = normalize(file);
    let score = 0;

    slugWords.forEach(word => {
      if (normFile.includes(word)) score++;
    });

    if (score > bestScore) {
      bestScore = score;
      bestMatch = file;
    }
  });

  return bestMatch
    ? `../assets/images/recipes/${bestMatch}`
    : "../assets/images/recipes/placeholder.jpg"; // fallback hvis intet matcher
}
</script>

<!-- HENT OPSKRIFTER + SØG / FILTER / PAGINATION -->
<script>
  let ALL_RECIPES = [];

  async function loadRecipes() {
    try {
      const res = await fetch("/assets/recipes.json");
      const data = await res.json();

      ALL_RECIPES = (data.recipes || [])
        .map(r => ({
          slug: r.slug,
          title: r.title,
          categories: r.categories || []
        }))
        .reverse(); // nyeste først
    } catch (err) {
      console.error("Fejl ved recipes.json:", err);
      ALL_RECIPES = [];
    }
  }

  document.addEventListener("DOMContentLoaded", async () => {
    await loadRecipes();

    const grid = document.getElementById("recipes-grid");
    const countEl = document.getElementById("recipes-count");
    const emptyState = document.getElementById("recipes-empty-state");
    const filterButtons = document.querySelectorAll(".filter-btn");
    const searchInput = document.getElementById("recipe-search");

    const PAGE_SIZE = 12;
    let activeFilter = "Alle";
    let searchQuery = "";
    let currentIndex = 0;
    let CURRENT_LIST = [];

    // “Vis flere”
    const loadMoreBtn = document.createElement("button");
    loadMoreBtn.textContent = "Vis flere opskrifter";
    loadMoreBtn.className = "btn btn-primary";
    loadMoreBtn.style.margin = "2rem auto 0";
    loadMoreBtn.style.display = "block";
    loadMoreBtn.style.padding = "0.75rem 1.5rem";
    loadMoreBtn.style.borderRadius = "999px";
    loadMoreBtn.style.background = "#fff";
    loadMoreBtn.style.border = "1px solid #ddd";
    loadMoreBtn.style.cursor = "pointer";
    grid.insertAdjacentElement("afterend", loadMoreBtn);

    function createCard(recipe) {
      const imgSrc = findBestImage(recipe.slug);

      return `
        <article class="category-card">
          <a class="category-card-link" href="./${recipe.slug}.html">
            <div class="category-card-image">
              <img src="${imgSrc}" alt="${recipe.title}">
            </div>
            <div class="category-card-body">
              <h3 class="category-card-title">${recipe.title}</h3>
            </div>
          </a>
        </article>`;
    }

    function renderChunk() {
      const slice = CURRENT_LIST.slice(currentIndex, currentIndex + PAGE_SIZE);

      slice.forEach(r => {
        grid.insertAdjacentHTML("beforeend", createCard(r));
      });

      currentIndex += PAGE_SIZE;
      loadMoreBtn.style.display = currentIndex < CURRENT_LIST.length ? "block" : "none";
    }

    function renderRecipes(list) {
      grid.innerHTML = "";
      CURRENT_LIST = list;
      currentIndex = 0;

      if (!list.length) {
        emptyState.style.display = "block";
        loadMoreBtn.style.display = "none";
        if (countEl) countEl.textContent = "Ingen opskrifter fundet.";
        return;
      }

      emptyState.style.display = "none";
      if (countEl) countEl.textContent = `Viser ${list.length} opskrifter`;

      renderChunk();
    }

    function applyFilters() {
      const q = searchQuery.toLowerCase();

      const filtered = ALL_RECIPES.filter(r => {
        const inFilter = activeFilter === "Alle" || r.categories.includes(activeFilter);
        const inSearch = (r.title || "").toLowerCase().includes(q);
        return inFilter && inSearch;
      });

      renderRecipes(filtered);
    }

    // Filterknapper
    filterButtons.forEach(btn =>
      btn.addEventListener("click", () => {
        filterButtons.forEach(b => b.classList.remove("is-active"));
        btn.classList.add("is-active");
        activeFilter = btn.dataset.filter || "Alle";
        applyFilters();
      })
    );

    // Live-søgning
    if (searchInput) {
      searchInput.addEventListener("input", () => {
        searchQuery = searchInput.value || "";
        applyFilters();
      });
    }

    // Vis flere
    loadMoreBtn.addEventListener("click", renderChunk);

    // Første load
    applyFilters();
  });
</script>


</body>
</html>
