<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <title>Alle opskrifter i airfryer ‚Äì Opskrift-Airfryer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
        content="Se alle vores airfryeropskrifter samlet √©t sted. S√∏g, filtr√©r og find pr√¶cis den opskrift du leder efter.">

  <link rel="stylesheet" href="../assets/styles.css" />

  <style>
    .filter-bar-inner {
      max-width: 1100px;
      margin: 0 auto;
      padding: 1.5rem 1.25rem 0;
    }
    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .filter-btn {
      border: 1px solid #e0e0e0;
      background: #ffffff;
      border-radius: 999px;
      padding: 0.35rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .filter-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.10);
    }
    .filter-btn.is-active {
      background: #111;
      color: #fff;
      border-color: #111;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1.75rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem;
    }

    .category-card {
      border: 1px solid #e5e5e5;
      border-radius: 14px;
      background: #fff;
      overflow: hidden;
      transition: transform .15s ease, box-shadow .15s ease;
    }
    .category-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.10);
    }

    .category-card-image img {
      display: block;
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      background: #fafafa;
    }

    .category-card-body {
      padding: 1rem;
    }

    .category-card-title {
      font-size: 1.05rem;
      margin: 0;
      font-weight: 600;
      color: #111;
    }
  </style>
</head>

<body>

<div data-include="icons"></div>
<div data-include="header"></div>

<section class="hero-large"
         style="background-image: url('../assets/images/hero/hero-julebord-airfryer-1920x1080.jpg');">
  <div class="hero-large-overlay"></div>

  <div class="hero-large-content">
    <h1 class="hero-large-title">Alle opskrifter i airfryer</h1>

    <p class="hero-large-subtitle">
      Scroll gennem alle opskrifter eller brug s√∏gning og kategorier for at finde pr√¶cis det, du leder efter.
    </p>

    <form class="hero-large-search" id="recipe-search-form" onsubmit="return false;">
      <input type="search" id="recipe-search" placeholder="S√∏g efter opskrift, ingrediens eller kategori ‚Ä¶" />
      <button type="submit">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="10" cy="10" r="7"></circle>
          <line x1="15" y1="15" x2="21" y2="21"></line>
        </svg>
      </button>
    </form>
  </div>
</section>

<main>

  <section class="section-category">
    <div class="category-header">
      <h2 class="section-title">V√¶lg kategori</h2>
      <p class="section-desc">Kombin√©r s√∏gning og filtrering ‚Äì eller v√¶lg ‚ÄúAlle‚Äù.</p>
    </div>

    <div class="filter-bar-inner">
      <div class="filter-buttons">
        <button class="filter-btn" data-filter="Alle">Alle</button>
        <button class="filter-btn" data-filter="sproede-kartofler">Spr√∏de kartofler</button>
        <button class="filter-btn" data-filter="kyllingefavoritter">Kyllingefavoritter</button>
        <button class="filter-btn" data-filter="nem-aftensmad">Nem aftensmad</button>
        <button class="filter-btn" data-filter="snacks-tilbehor">Snacks & tilbeh√∏r</button>
        <button class="filter-btn" data-filter="sund-airfryer">Sund airfryer</button>
        <button class="filter-btn" data-filter="morgenmad">Morgenmad</button>
        <button class="filter-btn" data-filter="bagvaerk">Bagv√¶rk & s√∏de sager</button>
        <button class="filter-btn" data-filter="jul">Jul</button>
      </div>
    </div>
  </section>

  <section class="section-category" style="margin-top:2rem; margin-bottom:3rem;">
    <div class="category-header">
      <h2 class="section-title" id="recipes-title">Alle opskrifter</h2>
      <p class="section-desc" id="recipes-count">Indl√¶ser opskrifter ‚Ä¶</p>
    </div>

    <div class="category-grid" id="recipes-grid"></div>

    <div id="recipes-empty-state"
         style="display:none; text-align:center; margin-top:2rem; max-width:720px; margin-left:auto; margin-right:auto; color:#666;">
      <p>Der er ingen opskrifter, der matcher din s√∏gning eller filtrering.</p>
    </div>
  </section>

</main>

<div data-include="footer"></div>
<div data-include="analytics"></div>

<script src="../assets/include.js" defer></script>
<script src="../assets/header.js" defer></script>

<!-- üî• BILLEDE-MATCH SYSTEM (REN VERSION) -->
<script>
const IMAGE_FILES = [
  "bacon-airfryer-768x768.jpg",
  "brunede-kartofler-i-airfryer-768x768.jpg",
  "chicken-nuggets-airfryer-768x768.jpg",
  "fiskefilet-768x768.jpg",
  "flaeskesteg-i-airfryer-768x768.jpg",
  "flaeskestegssandwich-768x768.jpg",
  "frikadeller-768x768.jpg",
  "grillede-groentsager-airfryer-768x768.jpg",
  "hel-and-i-airfryer-768x768.jpg",
  "hvidloegsbroed-airfryer-768x768.jpg",
  "kartoffelbaade-i-airfryer-768x768.jpg",
  "kyllinge-laar-airfryer-768x768.jpg",
  "kyllingebryst-airfryer-768x768.jpg",
  "kyllingevinger-i-airfryer-768x768.jpg",
  "laks-i-airfryer-768x768.jpg",
  "pommes-frites-768x768.jpg",
  "roedkaal-airfryer-768x768.jpg",
  "vegetar-tarteletter-768x768.jpg"
];


function normalize(str) {
  return (str || "")
    .toLowerCase()
    .replace(/-/g, " ")
    .replace(/√¶/g, "ae")
    .replace(/√∏/g, "oe")
    .replace(/√•/g, "aa")
    .replace(/[^\w\s]/g, "");
}

function findBestImage(slug) {
  const exactFile = `${slug}-768x768.jpg`;
  if (IMAGE_FILES.includes(exactFile))
    return `../assets/images/recipes/${exactFile}`;

  const normSlug = normalize(slug);
  const slugWords = normSlug.split(" ").filter(Boolean);

  let bestScore = -1;
  let bestMatch = null;

  IMAGE_FILES.forEach(file => {
    const normFile = normalize(file);
    let score = 0;

    slugWords.forEach(word => {
      if (normFile.includes(word)) score++;
    });

    if (score > bestScore) {
      bestScore = score;
      bestMatch = file;
    }
  });

  return bestMatch
    ? `../assets/images/recipes/${bestMatch}`
    : "../assets/images/recipes/placeholder.jpg";
}
</script>

<!-- üî• OPSKRIFT SYSTEM -->
<script>
let ALL_RECIPES = [];

async function loadRecipes() {
  try {
    const res = await fetch("/assets/recipes.json");
    const data = await res.json();
    ALL_RECIPES = (data.recipes || []).map(r => ({
      slug: r.slug,
      title: r.title,
      categories: r.categories || []
    })).reverse();
  } catch (err) {
    console.error("Fejl ved recipes.json:", err);
    ALL_RECIPES = [];
  }
}

document.addEventListener("DOMContentLoaded", async () => {
  await loadRecipes();

  const grid = document.getElementById("recipes-grid");
  const countEl = document.getElementById("recipes-count");
  const emptyState = document.getElementById("recipes-empty-state");
  const filterButtons = document.querySelectorAll(".filter-btn");
  const searchInput = document.getElementById("recipe-search");
  const titleEl = document.getElementById("recipes-title");

  const CATEGORY_LABELS = {
    "Alle": "Alle opskrifter",
    "sproede-kartofler": "Spr√∏de kartofler",
    "kyllingefavoritter": "Kyllingefavoritter",
    "nem-aftensmad": "Nem aftensmad",
    "snacks-tilbehor": "Snacks & tilbeh√∏r",
    "sund-airfryer": "Sund airfryer",
    "morgenmad": "Morgenmad",
    "bagvaerk": "Bagv√¶rk & s√∏de sager",
    "jul": "Jul"
  };

  const params = new URLSearchParams(window.location.search);
  let activeFilter = params.get("filter") || "Alle";
  let searchQuery = "";

  filterButtons.forEach(btn => {
    btn.classList.toggle("is-active", btn.dataset.filter === activeFilter);
  });

  const loadMoreBtn = document.createElement("button");
  loadMoreBtn.textContent = "Vis flere opskrifter";
  loadMoreBtn.className = "btn btn-primary";
  loadMoreBtn.style.margin = "2rem auto";
  loadMoreBtn.style.display = "block";
  loadMoreBtn.style.padding = "0.75rem 1.5rem";
  loadMoreBtn.style.borderRadius = "999px";
  grid.insertAdjacentElement("afterend", loadMoreBtn);

  let PAGE_SIZE = 12;
  let CURRENT_LIST = [];
  let currentIndex = 0;

  function updateTitle() {
    titleEl.textContent =
      activeFilter === "Alle"
        ? "Alle opskrifter"
        : `Opskrifter i: ${CATEGORY_LABELS[activeFilter]}`;
  }

  function createCard(recipe) {
    const imgSrc = findBestImage(recipe.slug);
    return `
      <article class="category-card">
        <a class="category-card-link" href="../opskrifter/${recipe.slug}.html">
          <div class="category-card-image">
            <img src="${imgSrc}" alt="${recipe.title}">
          </div>
          <div class="category-card-body">
            <h3 class="category-card-title">${recipe.title}</h3>
          </div>
        </a>
      </article>`;
  }

  function renderChunk() {
    const slice = CURRENT_LIST.slice(currentIndex, currentIndex + PAGE_SIZE);
    slice.forEach(r => grid.insertAdjacentHTML("beforeend", createCard(r)));
    currentIndex += PAGE_SIZE;

    loadMoreBtn.style.display =
      currentIndex < CURRENT_LIST.length ? "block" : "none";
  }

  function renderRecipes(list) {
    grid.innerHTML = "";
    CURRENT_LIST = list;
    currentIndex = 0;

    if (!list.length) {
      emptyState.style.display = "block";
      loadMoreBtn.style.display = "none";
      countEl.textContent = "Ingen opskrifter fundet.";
      updateTitle();
      return;
    }

    emptyState.style.display = "none";
    countEl.textContent = `Viser ${list.length} opskrifter`;
    updateTitle();
    renderChunk();
  }

  function applyFilters() {
    const q = searchQuery.toLowerCase();

    const filtered = ALL_RECIPES.filter(r => {
      const matchesFilter = activeFilter === "Alle" || r.categories.includes(activeFilter);
      const matchesSearch = r.title.toLowerCase().includes(q);
      return matchesFilter && matchesSearch;
    });

    renderRecipes(filtered);
  }

  filterButtons.forEach(btn =>
    btn.addEventListener("click", () => {
      filterButtons.forEach(b => b.classList.remove("is-active"));
      btn.classList.add("is-active");

      activeFilter = btn.dataset.filter;
      applyFilters();
    })
  );

  searchInput.addEventListener("input", () => {
    searchQuery = searchInput.value;
    applyFilters();
  });

  loadMoreBtn.addEventListener("click", renderChunk);

  applyFilters();
});
</script>

</body>
</html>
