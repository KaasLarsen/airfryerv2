<header class="site-header">
  <div class="header-inner">

    <!-- LOGO ‚Äì ALTID til roden -->
    <div class="header-logo">
      <a href="/">Opskrift-Airfryer</a>
    </div>

    <!-- DIN EKSISTERENDE MENU 100% UDEN √ÜNDRINGER -->
    <nav class="header-nav">
      <a href="/">Forside</a>
      <a href="/opskrifter.html">Opskrifter</a>
      <a href="/madplaner.html">Madplaner</a>
    </nav>

    <!-- ACTIONS (s√∏ge + ‚ù§Ô∏è GEMTE OPSKRIFTER) -->
    <div class="header-actions">

      <!-- S√òGE IKON (samme som f√∏r) -->
      <button class="header-icon" id="openSearch">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="7"></circle>
          <line x1="16" y1="16" x2="22" y2="22"></line>
        </svg>
      </button>

      <!-- ‚ù§Ô∏è HEART ICON (NYT) -->
      <button class="header-icon" id="openSaved">
        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 21s-6.3-4.2-9.3-8.1C-1.2 7 2 2 6.5 2c2.3 0 4 1.2 5.5 3 1.5-1.8 3.2-3 5.5-3C22 2 25.2 7 21.3 12.9C18.3 16.8 12 21 12 21z"/>
        </svg>
      </button>

    </div>
  </div>

  <!-- S√òGEBAR DROPDOWN -->
  <div class="header-searchbar" id="searchBar">
    <form action="/search.html" method="get">
      <input type="search" name="q" placeholder="S√∏g efter opskrifter‚Ä¶" />
    </form>
  </div>
</header>

<!-- FAVORIT PANEL -->
<div class="saved-drawer">
  <div class="saved-drawer-inner">

    <div class="saved-drawer-header">
      <h2>Gemte opskrifter</h2>
      <button id="closeSaved" class="close-btn">√ó</button>
    </div>

    <div class="saved-drawer-list" id="savedList">
      <p class="empty-text">Du har ingen gemte opskrifter endnu ‚ù§Ô∏è</p>
    </div>

  </div>
</div>


<!-- SCRIPT TIL HEADER + GEMTE OPSKRIFTER -->
<script>
  // Helpers til localStorage
  function getSaved() {
    return JSON.parse(localStorage.getItem("savedRecipes") || "[]");
  }

  function saveList(arr) {
    localStorage.setItem("savedRecipes", JSON.stringify(arr));
  }

  function renderSavedList() {
    const container = document.getElementById("savedList");
    if (!container) return;

    const saved = getSaved();
    container.innerHTML = "";

    if (saved.length === 0) {
      container.innerHTML = `<p class="empty-text">Du har ingen gemte opskrifter endnu ‚ù§Ô∏è</p>`;
      return;
    }

    saved.forEach(item => {
      container.innerHTML += `
        <div class="saved-item">
          <a href="${item.url}">
            <img src="${item.image}" alt="${item.title}">
          </a>
          <div>
            <a class="saved-item-title" href="${item.url}">${item.title}</a>
          </div>
        </div>
      `;
    });
  }

  function updateSaveButtons() {
    const saved = getSaved();
    document.querySelectorAll(".save-recipe-btn").forEach(btn => {
      const title = btn.dataset.recipe;
      const isSaved = saved.some(r => r.title === title);

      if (isSaved) {
        btn.textContent = "üíö Opskrift gemt (klik for at fjerne)";
      } else {
        btn.textContent = "‚ù§Ô∏è Gem opskrift";
      }
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    const searchBtn = document.getElementById("openSearch");
    const searchBar = document.getElementById("searchBar");
    const openSaved = document.getElementById("openSaved");
    const closeSaved = document.getElementById("closeSaved");
    const drawer = document.querySelector(".saved-drawer");

    // üîé Toggle s√∏gefelt
    if (searchBtn && searchBar) {
      searchBtn.addEventListener("click", () => {
        searchBar.style.display = (searchBar.style.display === "block") ? "none" : "block";
      });
    }

    // ‚ù§Ô∏è √Öbn/Luk favorit-panel
    if (openSaved && drawer) {
      openSaved.addEventListener("click", () => {
        drawer.classList.add("open");
        renderSavedList();
      });
    }

    if (closeSaved && drawer) {
      closeSaved.addEventListener("click", () => {
        drawer.classList.remove("open");
      });
    }

    // Klik udenfor = luk panel (valgfrit, men l√¶kkert UX)
    document.addEventListener("click", (e) => {
      if (!drawer) return;
      if (!drawer.classList.contains("open")) return;

      const isInsideDrawer = drawer.contains(e.target);
      const isHeartBtn = openSaved && openSaved.contains(e.target);

      if (!isInsideDrawer && !isHeartBtn) {
        drawer.classList.remove("open");
      }
    });

    // ‚ù§Ô∏è Knapper p√• opskriftssider
    document.querySelectorAll(".save-recipe-btn").forEach(btn => {
      const title = btn.dataset.recipe;
      const url = btn.dataset.url;
      const image = btn.dataset.image;

      if (!title || !url || !image) return;

      btn.addEventListener("click", () => {
        let saved = getSaved();
        const index = saved.findIndex(r => r.title === title);

        if (index !== -1) {
          // fjern
          saved.splice(index, 1);
        } else {
          // tilf√∏j
          saved.push({ title, url, image });
        }

        saveList(saved);
        updateSaveButtons();

        // hvis panelet er √•bent, opdater listen med det samme
        if (drawer && drawer.classList.contains("open")) {
          renderSavedList();
        }
      });
    });

    // initial state for knapper
    updateSaveButtons();
  });
</script>
